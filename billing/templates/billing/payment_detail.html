{% extends "base.html" %}

{% block title %}Payment {{ payment.payment_id }} - KNH HMS{% endblock %}

{% block page_title %}Payment Details{% endblock %}

{% block content %}
<div class="payment-detail-container">
    <!-- Payment Header -->
    <div class="payment-header">
        <div class="payment-info">
            <h2>Payment {{ payment.payment_id }}</h2>
            <div class="payment-status">
                <span class="status-badge status-completed">Completed</span>
            </div>
        </div>
        <div class="payment-actions">
            <a href="{% url 'billing:bill_detail' payment.bill.bill_id %}" class="btn btn-info">
                <i class="fas fa-file-invoice"></i> View Bill
            </a>
            <button onclick="window.print()" class="btn btn-secondary">
                <i class="fas fa-print"></i> Print Receipt
            </button>
        </div>
    </div>

    <div class="content-grid">
        <!-- Payment Information -->
        <div class="section-card">
            <h3><i class="fas fa-credit-card"></i> Payment Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <label>Payment ID:</label>
                    <span>{{ payment.payment_id }}</span>
                </div>
                <div class="info-item">
                    <label>Amount:</label>
                    <span class="amount">KSh {{ payment.amount|floatformat:2 }}</span>
                </div>
                <div class="info-item">
                    <label>Payment Method:</label>
                    <span>{{ payment.get_payment_method_display }}</span>
                </div>
                <div class="info-item">
                    <label>Transaction Reference:</label>
                    <span>{{ payment.transaction_reference|default:"N/A" }}</span>
                </div>
                <div class="info-item">
                    <label>Payment Date:</label>
                    <span>{{ payment.payment_date|date:"M d, Y H:i" }}</span>
                </div>
                <div class="info-item">
                    <label>Processed By:</label>
                    <span>{{ payment.processed_by.user.get_full_name }}</span>
                </div>
                {% if payment.notes %}
                <div class="info-item full-width">
                    <label>Notes:</label>
                    <span>{{ payment.notes }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Bill Information -->
        <div class="section-card">
            <h3><i class="fas fa-file-invoice"></i> Related Bill</h3>
            <div class="info-grid">
                <div class="info-item">
                    <label>Bill ID:</label>
                    <span>
                        <a href="{% url 'billing:bill_detail' bill.bill_id %}">{{ bill.bill_id }}</a>
                    </span>
                </div>
                <div class="info-item">
                    <label>Patient:</label>
                    <span>{{ bill.patient.user.get_full_name }}</span>
                </div>
                <div class="info-item">
                    <label>Total Amount:</label>
                    <span>KSh {{ bill.total_amount|floatformat:2 }}</span>
                </div>
                <div class="info-item">
                    <label>Amount Paid:</label>
                    <span>KSh {{ bill.amount_paid|floatformat:2 }}</span>
                </div>
                <div class="info-item">
                    <label>Balance Due:</label>
                    <span class="{% if bill.balance_due > 0 %}text-danger{% else %}text-success{% endif %}">
                        KSh {{ bill.balance_due|floatformat:2 }}
                    </span>
                </div>
                <div class="info-item">
                    <label>Bill Status:</label>
                    <span class="status-badge status-{{ bill.status }}">
                        {{ bill.get_status_display }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="navigation-bar">
        <a href="{% url 'billing:payment_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Payments
        </a>
        <a href="{% url 'billing:billing_dashboard' %}" class="btn btn-primary">
            <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
    </div>
</div>

<style>
    .payment-detail-container {
        max-width: 1000px;
        margin: 0 auto;
    }

    .payment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--white);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .payment-info h2 {
        margin: 0 0 10px 0;
        color: var(--primary-dark);
    }

    .payment-actions {
        display: flex;
        gap: 10px;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .section-card {
        background: var(--white);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .section-card h3 {
        margin: 0 0 20px 0;
        color: var(--primary-dark);
        border-bottom: 2px solid var(--primary-light);
        padding-bottom: 10px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-item.full-width {
        grid-column: 1 / -1;
    }

    .info-item label {
        font-weight: 600;
        color: var(--secondary-dark);
        margin-bottom: 5px;
    }

    .info-item span {
        color: var(--primary-dark);
    }

    .amount {
        font-size: 18px;
        font-weight: 700;
        color: var(--success);
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 14px;
        font-weight: 600;
    }

    .status-completed {
        background: var(--success);
        color: var(--white);
    }

    .status-paid {
        background: var(--success);
        color: var(--white);
    }

    .status-partial {
        background: var(--warning);
        color: var(--white);
    }

    .status-pending {
        background: var(--info);
        color: var(--white);
    }

    .text-danger {
        color: var(--danger);
    }

    .text-success {
        color: var(--success);
    }

    .navigation-bar {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    @media (max-width: 768px) {
        .content-grid {
            grid-template-columns: 1fr;
        }

        .payment-header {
            flex-direction: column;
            gap: 15px;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}